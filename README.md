# Excel需求文件导入到禅道系统

这个工具可以从Excel文件批量导入需求到禅道系统。它支持完整的需求字段映射，包括标题、优先级、分类等信息。

## 功能特点

- 支持批量导入需求
- 完整的字段映射
- 数据验证和错误处理
- 详细的导入报告
- 支持命令行参数

## 安装

1. 确保已安装Go 1.16或更高版本
2. 克隆仓库并构建：

```bash
git clone https://github.com/jan2xue/zentao_import_story.git
cd zentao_import_story
go build
```

## 配置文件

程序使用YAML格式的配置文件，包含以下配置项：

```yaml
# 禅道系统配置
zentaoUrl: "http://your-zentao-server.com"  # 禅道服务器地址
zentaoUsername: "admin"                      # 禅道用户名
zentaoPassword: "your-password"              # 禅道密码

# Excel文件配置
excelFile: "requirements.xlsx"               # Excel文件路径（可选）

# 默认值配置
defaultPriority: 3                           # 默认优先级（1-4）
```

可以复制`config.example.yaml`为`config.yaml`并修改配置。

## Excel文件格式

Excel文件必须包含以下列（*表示必填字段）：

| 标题* | 产品ID* | 优先级* | 分类* | 需求描述* | 父需求ID | 来源 | 来源备注 | 预计工时 | 关键词 | 验收标准 |
|-------|---------|---------|-------|--------|----------|------|----------|----------|---------|----------|

### 字段说明

- 标题：需求标题，必填
- 产品ID：禅道系统中的产品ID，必填
- 优先级：1-4之间的数字，必填
- 分类：需求分类，必填
  - 分类只能填写：
    - `feature`：功能
      - `interface`：接口
      - `performance`：性能
      - `safe`：安全
      - `experience`：体验
      - `improve`：改进
- 需求描述：需求详细描述，必填
- 父需求ID：父需求的ID，可选
  - 父需求ID指的是禅道系统的需求ID。建议慎重设置。
- 来源：需求来源，可选
  - 来源只能填写：
  - `customer`：客户
    - `po`：产品
    - `market`：市场
      - `user`：用户
- 来源备注：来源的补充说明，可选
  - 来源备注可以是任何文本，用于补充说明来源的具体情况，例如客户需求ID
- 预计工时：数字，可选
- 关键词：需求关键词，可选
- 验收标准：需求验收标准，可选

## 使用方法

1. 准备配置文件：

```bash
cp config.example.yaml config.yaml
# 编辑 config.yaml 填入实际配置
```

2. 准备Excel文件：
   - 创建Excel文件，按照上述格式填写需求信息
   - 确保必填字段已填写
   - 保存Excel文件

3. 运行程序：

```bash
# 使用配置文件中指定的Excel文件
./import_story -config config.yaml

# 或者通过命令行指定Excel文件
./import_story -config config.yaml -file requirements.xlsx
```

## 导入报告

程序会生成详细的导入报告，包含：

- 每个需求的导入结果
- 成功/失败数量统计
- 总耗时和平均耗时
- 成功率统计

示例报告：

```text
=== 需求导入报告 ===

✓ 需求 #1 导入成功 (ID: 123, 耗时: 1.2s)
✓ 需求 #2 导入成功 (ID: 124, 耗时: 1.1s)
✗ 需求 #3 导入失败: 产品ID不存在

总计统计:
- 总需求数: 3
- 成功导入: 2
- 失败数量: 1
- 总耗时: 3.5s
- 平均耗时: 1.17s
- 成功率: 66.7%
```

## 错误处理

程序会处理以下类型的错误：

- 配置文件错误
- Excel文件格式错误
- 必填字段缺失
- 字段格式错误
- 产品ID不存在
- 网络连接错误
- API调用错误

当发生错误时：

- 对于单个需求的错误，程序会继续处理其他需求
- 错误信息会记录在导入报告中
- 如果有任何需求导入失败，程序将以非零状态码退出

## 注意事项

1. 确保Excel文件使用正确的格式和编码（推荐UTF-8）
2. 验证禅道系统的连接和认证信息
3. 检查产品ID是否存在且有权限访问
4. 对于大量需求，建议分批导入

## 常见问题

1. 如果遇到"产品ID不存在"错误：
   - 检查产品ID是否正确
   - 验证当前用户是否有权限访问该产品

2. 如果遇到认证错误：
   - 检查禅道URL是否正确
   - 验证用户名和密码是否正确
   - 确认用户有创建需求的权限

3. 如果Excel解析错误：
   - 检查Excel文件格式是否正确
   - 确保必填字段已填写
   - 验证字段格式（如优先级是否为1-4的数字）

## 许可证

MIT License
